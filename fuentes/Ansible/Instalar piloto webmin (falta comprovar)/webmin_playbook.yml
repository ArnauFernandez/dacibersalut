- name: Instalacion pilot de webmin
  hosts: webmin_server
  become: true
  tasks:
    - name: Instalar paquetes necessarios
      apt:
        name:
            - apt-transport-https
            - software-properties-common
            - wget
        state: present
        update_cache: yes

    - name: Agregar repositorio webmin
      apt_repository:
        repo: deb https://download.webmin.com/download/repository sarge contrib
        state: present
        update_cache: yes

    - name: Agregar clave del repositorio de webmin
      shell: wget -qO - http://www.webmin.com/jcameron-key.asc | apt-key add -

    - name: InstalÂ·lar Webmin
      apt:
        name: webmin
        state: present
        update_cache: yes

    - name: Assegurar que webmin este activo i habilitado
      systemd:
        name: webmin
        enabled: yes
        state: started

    - name: Abrir puerto 10000
      ufw:
        rule: allow
        port: 10000
        proto: tcp
        state: enabled
        action: insert
        position: 1
        comment: "Permetre accedir a Webmin"

    - name: Mostrar la URL de accesso a webmin
      debug:
        msg: "Accedeix a Webmin a https://{{ ansible_host }}:10000 amb l'usuari root i la contrasenya que has definit"

